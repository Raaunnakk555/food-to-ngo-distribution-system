<!DOCTYPE html>
<html>
<head>
  <title>Restaurant Orders</title>
</head>

<body>

<h2>Pending Orders</h2>
<div id="orders"></div>

<script src="js/auth.js"></script>
<script>
const user = JSON.parse(localStorage.getItem("user"));

if (!user || user.role !== "restaurant") {
  alert("Login required!");
  window.location.href = "restaurant-login.html";
}

function loadOrders() {

  const orders =
    JSON.parse(localStorage.getItem("orders")) || [];

  const div =
    document.getElementById("orders");

  div.innerHTML = "";

orders.forEach((o, index) => {

  if (
    o.status !== "Pending" ||
    !o.restaurants?.includes(
      user?.restaurantName
    )
  ) return;

  div.innerHTML += `
    <p>
      NGO: ${o.ngo}<br>
      OTP:
      <input id="otp${index}">
      <button onclick="verify(${index})">
        Verify
      </button>
    </p>
    <hr>
  `;
});
}

function verify(i) {

  const orders =
    JSON.parse(localStorage.getItem("orders")) || [];

  const val =
    document.getElementById("otp" + i).value;

  if (val == orders[i].otp) {

    orders[i].status = "Completed";

    localStorage.setItem(
      "orders",
      JSON.stringify(orders)
    );

    alert("Order verified!");
    loadOrders();

  } else {
    alert("Wrong OTP!");
  }
}

loadOrders();

</script>

</body>
</html>
